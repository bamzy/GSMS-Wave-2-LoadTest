  function sv_load_intray(intrayparams){ 
    var divid = intrayparams.DIVID;  
    $("#"+sits_do_get_object(divid)).data("intrayparams",intrayparams).prepend(intrayparams.IMG1+" "+sits_widget_bp.ui.loading);          
    $("#"+sits_do_get_object(divid)).find("div.sv-row:first").css("visibility","hidden");
    var list = "NKEY="+intrayparams.NKEY+"&MHV_CODE="+sits_escape_url(intrayparams.MHVC);
    list += "&PAGE="+intrayparams.PAGE+"&ORDR="+intrayparams.ORDR;
    list += "&ISSC="+intrayparams.ISSC+"&DIVID="+intrayparams.DIVID;
    sits_send_query("POST","SIW_INTRAY.getintray",list,false,"sv_intray_return");        
    return;
  }   
  function sv_intray_return(response){
    var obj= {};
    if ( response == "" ){
      return;
    }
    obj = sits_parse_json(response);    
    if ( typeof(obj) != "object"){
      return;
    }
    $("#"+obj.DIVID).data("TABLEID",obj.TABLEID).html(obj.HTML);
    $("#"+obj.TABLEID).data("DIVID",obj.DIVID);    
    $("#intray_panel_"+obj.TABLEID).data("DIVID",obj.DIVID)  ;   
    var intrayparams = {};
    intrayparams = $("#"+obj.DIVID).data("intrayparams");
    sits_tablesaw_widget("#"+obj.TABLEID,"");
    var refresh = intrayparams.REFRESH || 60000; // default refresh to 60 seconds
    setTimeout(function(){ sv_intray_refresh(obj.TABLEID);},refresh);
  }  
  function sv_intray_changepage(page,TABLEID){
    var divid = getdivid(TABLEID);  
    var intrayparams = {};
    intrayparams = $("#"+divid).data("intrayparams");
    intrayparams.PAGE = page;
    sv_load_intray(intrayparams)    ;
  }
  function sv_intray_refresh(TABLEID){
    var divid = getdivid(TABLEID);  
    var intrayparams = {};
    intrayparams = $("#"+divid).data("intrayparams");
    if (typeof(intrayparams) == "object"){
      sv_load_intray(intrayparams)     ;
    }
  }
  function sv_intray_switchview(sel,TABLEID){
    var divid = getdivid(TABLEID);  
    var val = $(sel).val();
    var intrayparams = {};
    intrayparams = $("#"+divid).data("intrayparams");
    if (typeof(intrayparams) == "object"){
      intrayparams.MHVC = val;
      intrayparams.ORDR = "";
      intrayparams.PAGE = 1;
      sv_load_intray(intrayparams);
    }     
  }  
  function getdivid(TABLEID){
    var divid = $("#"+TABLEID).data("DIVID") ||  $("#intray_panel_"+TABLEID).data("DIVID") ;
    return divid;
  }      
  function sv_intray_sortview(srt,TABLEID){
    var divid = getdivid(TABLEID);  
    var intrayparams = {};
    intrayparams = $("#"+divid).data("intrayparams");
    if (typeof(intrayparams) == "object"){
      intrayparams.ORDR = srt;
      intrayparams.PAGE = 1;
      sv_load_intray(intrayparams);
    }     
  }  
 
